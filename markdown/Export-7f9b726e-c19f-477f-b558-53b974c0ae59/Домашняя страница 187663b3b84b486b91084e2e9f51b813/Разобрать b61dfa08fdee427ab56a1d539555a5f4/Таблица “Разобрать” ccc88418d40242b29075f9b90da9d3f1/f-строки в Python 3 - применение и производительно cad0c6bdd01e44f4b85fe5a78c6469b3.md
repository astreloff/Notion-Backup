# f-строки в Python 3 - применение и производительность

Date [HIDE]: October 2, 2022 7:08 AM
Без разбора: 159 дней
Добавлено: 02.10.2022
Категория: Программирование
Разобрано: No
Ссылка: https://shultais.education/blog/python-f-strings
Темы: https://www.notion.so/Python-56ea1d4987c94572bc191d10854812ef

![f-%D1%81%D1%82%D1%80%D0%BE%D0%BA%D0%B8%20%D0%B2%20Python%203%20-%20%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B8%20%D0%BF%D1%80%D0%BE%D0%B8%D0%B7%D0%B2%D0%BE%D0%B4%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE%20cad0c6bdd01e44f4b85fe5a78c6469b3/f-string.png](f-%D1%81%D1%82%D1%80%D0%BE%D0%BA%D0%B8%20%D0%B2%20Python%203%20-%20%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B8%20%D0%BF%D1%80%D0%BE%D0%B8%D0%B7%D0%B2%D0%BE%D0%B4%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE%20cad0c6bdd01e44f4b85fe5a78c6469b3/f-string.png)

Поделись постом с друзьями:

Начиная с версии 3.6 в Python появился новый тип строк — **f-строки**, которые буквально означают «formatted string». Эти строки улучшают читаемость кода, а также работают быстрее чем другие способы форматирования. F-строки задаются с помощью литерала «f» перед кавычками.

```
>>> "обычная строка"
>>> f"f-строка"
```

f-строки - это пятый способ (sic!) форматирования строк в Python, который очень похож на использование метода format().

Вспомним все 5 способов форматирования.

## 5 способов форматирования строк

1. **Конкатенация.** Грубый способ форматирования, в котором мы просто склеиваем несколько строк с помощью операции сложения:

```
>>> name = "Дмитрий"
>>> age = 25
>>> print("Меня зовут " + name + ". Мне " + str(age) + " лет.")
>>> Меня зовут Дмитрий. Мне 25 лет.
```

2. **%-форматирование.** Самый популярный способ, который перешел в Python из языка С. Передавать значения в строку можно через списки и кортежи , а также и с помощью словаря. Во втором случае значения помещаются не по позиции, а в соответствии с именами.

```
>>> name = "Дмитрий"
>>> age = 25
>>> print("Меня зовут %s. Мне %d лет." % (name, age))
>>> Меня зовут Дмитрий. Мне 25 лет.
>>> print("Меня зовут %(name)s. Мне %(age)d лет." % {"name": name, "age": age})
>>> Меня зовут Дмитрий. Мне 25 лет.
```

3. **Template-строки.** Этот способ появился в Python 2.4, как замена %-форматированию ([PEP 292](https://www.python.org/dev/peps/pep-0292/)), но популярным так и не стал. Поддерживает передачу значений по имени и использует $-синтаксис как в PHP.

```
>>> from string import Template
>>> name = "Дмитрий"
>>> age = 25
>>> s = Template('Меня зовут $name. Мне $age лет.')
>>> print(s.substitute(name=name, age=age))
>>> Меня зовут Дмитрий. Мне 25 лет.
```

4. **Форматирование с помощью метода format().** Этот способ появился в Python 3 в качестве замены %-форматированию. Он также поддерживает передачу значений по позиции и по имени.

```
>>> name = "Дмитрий"
>>> age = 25
>>> print("Меня зовут {}. Мне {} лет.".format(name, age)
>>> Меня зовут Дмитрий. Мне 25 лет.
>>> print("Меня зовут {name} Мне {age} лет.".format(age=age, name=name)
>>> Меня зовут Дмитрий. Мне 25 лет.
```

5. **f-строки.** Форматирование, которое появилось в Python 3.6 ([PEP 498](https://www.python.org/dev/peps/pep-0498/)). Этот способ похож на форматирование с помощью метода format(), но гибче, читабельней и быстрей.

```
>>> name = "Дмитрий"
>>> age = 25
>>> print(f"Меня зовут {name} Мне {age} лет.")
>>> Меня зовут Дмитрий. Мне 25 лет.
```

## Погружене в f-строки

f-строки делают очень простую вещь — они берут значения переменных, которые есть в текущей области видимости, и подставляют их в строку. В самой строке вам лишь нужно указать имя этой переменной в фигурных скобках.

```
>>> name = "Дмитрий"
>>> age = 25
>>> print(f"Меня зовут {name} Мне {age} лет.")
>>> Меня зовут Дмитрий. Мне 25 лет.
```

f-строки также поддерживают расширенное форматирование чисел:

```
>>> from math import pi
>>> print(f"Значение числа pi: {pi:.2f}")
>>> Значение числа pi: 3.14
```

С помощью f-строк можно форматировать дату без вызова метода strftime():

```
>>> from datetime import datetime as dt
>>> now = dt.now()
>>> print(f"Текущее время {now:%d.%m.%Y %H:%M}")
>>> Текущее время 24.02.2017 15:51
```

Они поддерживают базовые арифметические операции. Да, прямо в строках:

```
>>> x = 10
>>> y = 5
>>> print(f"{x} x {y} / 2 = {x * y / 2}")
>>> 10 x 5 / 2 = 25.0
```

Позволяют обращаться к значениям списков по индексу:

```
>>> planets = ["Меркурий", "Венера", "Земля", "Марс"]
>>> print(f"Мы живим не планете {planets[2]}")
>>> Мы живим не планете Земля
```

А также к элементам словаря по ключу:

```
>>> planet = {"name": "Земля", "radius": 6378000}
>>> print(f"Планета {planet['name']}. Радиус {planet['radius']/1000} км.")
>>> Планета Земля. Радиус 6378.0 км.
```

Причем вы можете использовать как строковые, так и числовые ключи. Точно также как в обычном Python коде:

```
>>> digits = {0: 'ноль', 'one': 'один'}
>>> print(f"0 - {digits[0]}, 1 - {digits['one']}")
>>> 0 - ноль, 1 - один
```

Вы можете вызывать в f-строках методы объектов:

```
>>> name = "Дмитрий"
>>> print(f"Имя: {name.upper()}")
>>> Имя: ДМИТИРИЙ
```

А также вызывать функции:

```
>>> print(f"13 / 3 = {round(13/3)}")
>>> 13 / 3 = 4
```

f-строки очень гибкий и мощный инструмент для создания самых разнообразных шаблонов.

Со всеми возможностя f-строк вы можете ознакомится в [PEP498](https://www.python.org/dev/peps/pep-0498/).

## Производительность

F-строки не только гибкие, но и быстрые. И для сравнения производительности разных подходов к форматированию я подготовил два шаблона:

- **простой**, в который нужно вставить всего два значения: строку и число;
- **сложный**, данные для которого собираются из разных переменных, а внутри происходит преобразование даты, вещественного числа, а также округление.

Финальная простая строка получается такой:

> Привет, меня зовут Дмитрий. Мне 27 лет.
> 

Сложная строка на выходе такая:

> Сегодня 24.02.2017.
> 

Далее я написал 5 функций, каждая из которых возвращает строку отформатированную одним из способом, а после запустил каждую функцию много раз. Пример всех функций и тестового скрипта можете скачать [тут](https://shultais.education/media/blog/2017/f-strings/f_strings.zip).

После недолгого тестирования я получил следующие результаты:

![f-%D1%81%D1%82%D1%80%D0%BE%D0%BA%D0%B8%20%D0%B2%20Python%203%20-%20%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B8%20%D0%BF%D1%80%D0%BE%D0%B8%D0%B7%D0%B2%D0%BE%D0%B4%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE%20cad0c6bdd01e44f4b85fe5a78c6469b3/f-strings-graph_01.jpg](f-%D1%81%D1%82%D1%80%D0%BE%D0%BA%D0%B8%20%D0%B2%20Python%203%20-%20%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B8%20%D0%BF%D1%80%D0%BE%D0%B8%D0%B7%D0%B2%D0%BE%D0%B4%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE%20cad0c6bdd01e44f4b85fe5a78c6469b3/f-strings-graph_01.jpg)

На простых примерах f-строки показывают самые лучшие результаты.**На 25% быстрее** %-форматирования и метода format().

![f-%D1%81%D1%82%D1%80%D0%BE%D0%BA%D0%B8%20%D0%B2%20Python%203%20-%20%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B8%20%D0%BF%D1%80%D0%BE%D0%B8%D0%B7%D0%B2%D0%BE%D0%B4%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE%20cad0c6bdd01e44f4b85fe5a78c6469b3/f-strings-graph_02.jpg](f-%D1%81%D1%82%D1%80%D0%BE%D0%BA%D0%B8%20%D0%B2%20Python%203%20-%20%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B8%20%D0%BF%D1%80%D0%BE%D0%B8%D0%B7%D0%B2%D0%BE%D0%B4%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE%20cad0c6bdd01e44f4b85fe5a78c6469b3/f-strings-graph_02.jpg)

На сложных шаблонах f-строки ведут себя также как %-форматирование
 (разница в пользу %-форматирования не превышает величину погрешности).
А вот относительно метода format() f-строки **быстрее на 27%**.

## Заключение

Если вы используете Python 3.6 и старше, то самое время использовать f-строки — они гибкие и быстрые.