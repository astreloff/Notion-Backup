<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Создаем модуль для Telegram bot api на Python</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	text-indent: -1.7em;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-opaquegray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="1425a4c1-aaf1-4b1b-b79c-8b9cffd53bcc" class="page sans"><header><h1 class="page-title">Создаем модуль для Telegram bot api на Python</h1><table class="properties"><tbody><tr class="property-row property-row-url"><th><span class="icon property-icon"><svg viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0;-webkit-backface-visibility:hidden" class="typesUrl"><path d="M7.69922 10.8945L8.73828 9.84863C7.91797 9.77344 7.34375 9.51367 6.91992 9.08984C5.76465 7.93457 5.76465 6.29395 6.91309 5.14551L9.18262 2.87598C10.3379 1.7207 11.9717 1.7207 13.127 2.87598C14.2891 4.04492 14.2822 5.67188 13.1338 6.82031L11.958 7.99609C12.1768 8.49512 12.2451 9.10352 12.1289 9.62988L14.0908 7.6748C15.7725 6 15.7793 3.62109 14.084 1.92578C12.3887 0.223633 10.0098 0.237305 8.33496 1.91211L5.95605 4.29785C4.28125 5.97266 4.26758 8.35156 5.96289 10.0469C6.36621 10.4434 6.90625 10.7441 7.69922 10.8945ZM8.30078 5.13184L7.26855 6.17773C8.08203 6.25293 8.66309 6.51953 9.08008 6.93652C10.2422 8.09863 10.2422 9.73242 9.08691 10.8809L6.81738 13.1504C5.66211 14.3057 4.03516 14.3057 2.87305 13.1504C1.71094 11.9883 1.71777 10.3545 2.87305 9.20605L4.04199 8.03027C3.83008 7.53125 3.75488 6.92969 3.87109 6.39648L1.91602 8.35156C0.234375 10.0264 0.227539 12.4121 1.92285 14.1074C3.61816 15.8027 5.99707 15.7891 7.67188 14.1143L10.0439 11.7354C11.7256 10.0537 11.7324 7.6748 10.0371 5.98633C9.64062 5.58301 9.10059 5.28223 8.30078 5.13184Z"></path></svg></span>Ссылка</th><td><a href="https://habr.com/ru/post/677456/" class="url-value">https://habr.com/ru/post/677456/</a></td></tr><tr class="property-row property-row-relation"><th><span class="icon property-icon"><svg viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0;-webkit-backface-visibility:hidden" class="typesRelation"><path d="M13.1475 10.5869V3.72363C13.1475 3.25195 12.833 2.93066 12.3477 2.93066H5.48438C5.02637 2.93066 4.70508 3.27246 4.70508 3.67578C4.70508 4.07227 5.05371 4.40039 5.46387 4.40039H7.89746L10.8438 4.30469L9.59961 5.39844L3.08496 11.9199C2.92773 12.0771 2.8457 12.2686 2.8457 12.46C2.8457 12.8564 3.20801 13.2256 3.61816 13.2256C3.80957 13.2256 3.99414 13.1504 4.15137 12.9932L10.6729 6.47168L11.7803 5.22754L11.6641 8.05762V10.6074C11.6641 11.0176 11.9922 11.373 12.4023 11.373C12.8057 11.373 13.1475 11.0312 13.1475 10.5869Z"></path></svg></span>Темы</th><td><a href="https://www.notion.so/Python-56ea1d4987c94572bc191d10854812ef"><img class="icon" src="https://www.notion.so/icons/code_gray.svg"/>Python</a></td></tr><tr class="property-row property-row-select"><th><span class="icon property-icon"><svg viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0;-webkit-backface-visibility:hidden" class="typesSelect"><path d="M8 15.126C11.8623 15.126 15.0615 11.9336 15.0615 8.06445C15.0615 4.20215 11.8623 1.00293 7.99316 1.00293C4.13086 1.00293 0.938477 4.20215 0.938477 8.06445C0.938477 11.9336 4.1377 15.126 8 15.126ZM8 13.7383C4.85547 13.7383 2.33301 11.209 2.33301 8.06445C2.33301 4.91992 4.84863 2.39746 7.99316 2.39746C11.1377 2.39746 13.6738 4.91992 13.6738 8.06445C13.6738 11.209 11.1445 13.7383 8 13.7383ZM7.62402 10.6348C7.79492 10.915 8.20508 10.9287 8.37598 10.6348L10.666 6.73145C10.8574 6.41016 10.7002 6.04102 10.3652 6.04102H5.62793C5.29297 6.04102 5.14941 6.43066 5.32031 6.73145L7.62402 10.6348Z"></path></svg></span>Категория</th><td></td></tr><tr class="property-row property-row-formula"><th><span class="icon property-icon"><svg viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0;-webkit-backface-visibility:hidden" class="typesFormula"><path d="M5.04688 14.3604H11.2744C11.7324 14.3604 12.0537 14.0801 12.0537 13.6494C12.0537 13.2119 11.7324 12.9248 11.2744 12.9248H5.81934V12.8564L9.30566 8.82324C9.54492 8.57031 9.6748 8.29688 9.6748 8.0166C9.6748 7.73633 9.54492 7.45605 9.29883 7.20996L5.81934 3.2793V3.21094H11.2812C11.7393 3.21094 12.0537 2.92383 12.0537 2.48633C12.0537 2.05566 11.7393 1.77539 11.2812 1.77539H5.05371C4.34277 1.77539 3.95312 2.26758 3.95312 2.81445C3.95312 3.12207 4.07617 3.44336 4.33594 3.69629L8.15039 7.96875V8.05078L4.3291 12.4395C4.06934 12.6924 3.94629 13.0137 3.94629 13.3213C3.94629 13.8682 4.33594 14.3604 5.04688 14.3604Z"></path></svg></span>Добавлено</th><td>02.10.2022</td></tr><tr class="property-row property-row-checkbox"><th><span class="icon property-icon"><svg viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0;-webkit-backface-visibility:hidden" class="typesCheckbox"><path d="M3.85742 14.4561H12.1357C13.6123 14.4561 14.3779 13.6904 14.3779 12.2344V3.91504C14.3779 2.45215 13.6123 1.69336 12.1357 1.69336H3.85742C2.38086 1.69336 1.61523 2.45215 1.61523 3.91504V12.2344C1.61523 13.6973 2.38086 14.4561 3.85742 14.4561ZM3.93945 13.1162C3.30371 13.1162 2.95508 12.7812 2.95508 12.1182V4.02441C2.95508 3.36133 3.30371 3.0332 3.93945 3.0332H12.0537C12.6826 3.0332 13.0381 3.36133 13.0381 4.02441V12.1182C13.0381 12.7812 12.6826 13.1162 12.0537 13.1162H3.93945ZM7.26855 11.3115C7.51465 11.3115 7.72656 11.1885 7.87012 10.9697L10.9258 6.19141C11.0146 6.04785 11.0967 5.88379 11.0967 5.72656C11.0967 5.3916 10.7959 5.16602 10.4746 5.16602C10.2695 5.16602 10.085 5.27539 9.94141 5.50781L7.24121 9.8418L5.96973 8.22168C5.80566 8.00977 5.6416 7.93457 5.43652 7.93457C5.10156 7.93457 4.8418 8.20117 4.8418 8.54297C4.8418 8.70703 4.90332 8.85742 5.01953 9.00098L6.63281 10.9697C6.81738 11.209 7.01562 11.3115 7.26855 11.3115Z"></path></svg></span>Разобрано</th><td><div class="checkbox checkbox-off"></div></td></tr><tr class="property-row property-row-formula"><th><span class="icon property-icon"><svg viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0;-webkit-backface-visibility:hidden" class="typesFormula"><path d="M5.04688 14.3604H11.2744C11.7324 14.3604 12.0537 14.0801 12.0537 13.6494C12.0537 13.2119 11.7324 12.9248 11.2744 12.9248H5.81934V12.8564L9.30566 8.82324C9.54492 8.57031 9.6748 8.29688 9.6748 8.0166C9.6748 7.73633 9.54492 7.45605 9.29883 7.20996L5.81934 3.2793V3.21094H11.2812C11.7393 3.21094 12.0537 2.92383 12.0537 2.48633C12.0537 2.05566 11.7393 1.77539 11.2812 1.77539H5.05371C4.34277 1.77539 3.95312 2.26758 3.95312 2.81445C3.95312 3.12207 4.07617 3.44336 4.33594 3.69629L8.15039 7.96875V8.05078L4.3291 12.4395C4.06934 12.6924 3.94629 13.0137 3.94629 13.3213C3.94629 13.8682 4.33594 14.3604 5.04688 14.3604Z"></path></svg></span>Без разбора</th><td>161 дней</td></tr><tr class="property-row property-row-relation"><th><span class="icon property-icon"><svg viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0;-webkit-backface-visibility:hidden" class="typesRelation"><path d="M13.1475 10.5869V3.72363C13.1475 3.25195 12.833 2.93066 12.3477 2.93066H5.48438C5.02637 2.93066 4.70508 3.27246 4.70508 3.67578C4.70508 4.07227 5.05371 4.40039 5.46387 4.40039H7.89746L10.8438 4.30469L9.59961 5.39844L3.08496 11.9199C2.92773 12.0771 2.8457 12.2686 2.8457 12.46C2.8457 12.8564 3.20801 13.2256 3.61816 13.2256C3.80957 13.2256 3.99414 13.1504 4.15137 12.9932L10.6729 6.47168L11.7803 5.22754L11.6641 8.05762V10.6074C11.6641 11.0176 11.9922 11.373 12.4023 11.373C12.8057 11.373 13.1475 11.0312 13.1475 10.5869Z"></path></svg></span>Связь &quot;Разобрать&quot;</th><td></td></tr><tr class="property-row property-row-created_time"><th><span class="icon property-icon"><svg viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0;-webkit-backface-visibility:hidden" class="typesCreatedAt"><path d="M8 15.126C11.8623 15.126 15.0615 11.9336 15.0615 8.06445C15.0615 4.20215 11.8623 1.00293 7.99316 1.00293C4.13086 1.00293 0.938477 4.20215 0.938477 8.06445C0.938477 11.9336 4.1377 15.126 8 15.126ZM8 13.7383C4.85547 13.7383 2.33301 11.209 2.33301 8.06445C2.33301 4.91992 4.84863 2.39746 7.99316 2.39746C11.1377 2.39746 13.6738 4.91992 13.6738 8.06445C13.6738 11.209 11.1445 13.7383 8 13.7383ZM4.54102 8.91211H7.99316C8.30078 8.91211 8.54004 8.67285 8.54004 8.37207V3.8877C8.54004 3.58691 8.30078 3.34766 7.99316 3.34766C7.69238 3.34766 7.45312 3.58691 7.45312 3.8877V7.83203H4.54102C4.2334 7.83203 4.00098 8.06445 4.00098 8.37207C4.00098 8.67285 4.2334 8.91211 4.54102 8.91211Z"></path></svg></span>Date [HIDE]</th><td><time>@October 2, 2022 8:11 AM</time></td></tr></tbody></table></header><div class="page-body"><figure id="6a8cf2b6-7572-44ae-a01b-0214a6a60ef6" class="image"><a href="%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%B5%D0%BC%20%D0%BC%D0%BE%D0%B4%D1%83%D0%BB%D1%8C%20%D0%B4%D0%BB%D1%8F%20Telegram%20bot%20api%20%D0%BD%D0%B0%20Python%201425a4c1aaf14b1bb79c8b9cffd53bcc/Unknown%20file"><img style="width:700px" src="%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%B5%D0%BC%20%D0%BC%D0%BE%D0%B4%D1%83%D0%BB%D1%8C%20%D0%B4%D0%BB%D1%8F%20Telegram%20bot%20api%20%D0%BD%D0%B0%20Python%201425a4c1aaf14b1bb79c8b9cffd53bcc/Unknown%20file"/></a></figure><p id="27bc0773-cfea-4ac0-8479-39b6418bde69" class="">Привет! Я непрофессиональный разработчик, программирование - это мое хобби. И &quot;подхобби&quot; этого хобби - брать готовые инструменты и создавать их аналоги, просто, чтобы разобраться в интересной теме (а еще переделать всё по своему желанию :)). В этот раз, я решил закодить аналог для таких модулей как aiogram или асинхронная версия PyTelegramBotApi.</p><h2 id="c6f5c7f4-f476-42f0-b4fb-fc76548468f1" class="">Дисклеймер</h2><p id="c5bc1451-3c6e-4b27-abdd-9d31185ca25e" class="">В этой статье будет оочень много решений, которые вам покажутся странными, в моем коде будет очень много уязвимостей, проблем и т.д. Я плохо знаком с темой и не буду использовать свое решение в серьезных проектах. Поэтому, я буду очень рад, если вы уделите мне немного вашего времени и напишете об основных проблемах моего модуля в комментариях. В целом, ради этого я и пишу статью. Спасибо!)</p><h2 id="1dcf0898-378f-469c-ad3f-77d4df531d2d" class="">Проблема pyTelegramBotApi</h2><p id="1e8bd9b1-ad29-4aa1-be7d-2ec9d9ca62f5" class="">До написания этой статьи, я некоторое время пользовался модулем pyTelegramBotApi, за это время, мне приходилось несколько раз залезать в его исходный код и я заметил деталь, которая мне совсем не понравилась - это многократное дублирование кода. Например, первая же функция process_updates, которая делит апдейты, полученные от телеграма на типы и запускает для каждого из них свою функцию process_..._updates, встречает нас вот таким:</p><pre id="2cf150cf-decc-4df0-8ea2-5b28145c8929" class="code code-wrap"><code>new_messages = None
new_edited_messages = None
# Тут еще 11 таких же присвоений
chat_join_request = None

for update in updates:
    logger.debug(&#x27;Processing updates: {0}&#x27;.format(update))
    if update.message:
        if new_messages is None: new_messages = []
        new_messages.append(update.message)
    if update.edited_message:
        if new_edited_messages is None: new_edited_messages = []
        new_edited_messages.append(update.edited_message)
    ... # Тут еще 11 таких же условий
    if update.chat_join_request:
        if chat_join_request is None: chat_join_request = []
        chat_join_request.append(update.chat_join_request)
if new_messages:
    await self.process_new_messages(new_messages)
if new_edited_messages:
    await self.process_new_edited_messages(new_edited_messages)
... # И тут еще 11 таких же условий
if chat_join_request:
    await self.process_chat_join_request(chat_join_request)</code></pre><p id="cca6c58e-fa50-45b0-b845-447bc0ab8ecb" class="">Кроме того, определение каждого метода, повторяющего методы Telegram Bot Api, выглядит так:</p><pre id="068aa317-aa0a-40e8-8999-c704ef4e1a0b" class="code code-wrap"><code>async def send_message(
        self, chat_id: Union[int, str], text: str,
        parse_mode: Optional[str]=None,
        entities: Optional[List[types.MessageEntity]]=None,
        disable_web_page_preview: Optional[bool]=None,
        disable_notification: Optional[bool]=None,
        protect_content: Optional[bool]=None,
        reply_to_message_id: Optional[int]=None,
        allow_sending_without_reply: Optional[bool]=None,
        reply_markup: Optional[REPLY_MARKUP_TYPES]=None,
        timeout: Optional[int]=None) -&gt; types.Message:</code></pre><p id="1f5c5b31-a6a1-4153-b7f2-3da8108e871b" class="">Таким образом, внутри модуля содержится полная копия документации API, в том числе, в нем описаны все аргументы методов.</p><p id="00fa28b4-b866-4aca-852f-6dc77fcdfd25" class="">На мой взгляд это:</p><ol type="1" id="957a1f0a-1c1b-40b2-bf35-2da3900574cc" class="numbered-list" start="1"><li>Бессмысленно.</li></ol><ol type="1" id="1b2381c3-4576-49ed-903c-bb3cb7b76dde" class="numbered-list" start="2"><li>Приводит к таким ситуациям, когда API был обновлен, а модуль еще нет - и разработчику модуля приходится реализовывать в нем ровно ту же логику, которая была добавлена в API. Я лично столкнулся с ситуацией, когда мне пришлось самому дописывать модуль, так как вышла новая версия api, и разработчик еще не успел его обновить.</li></ol><ol type="1" id="0f29514b-966e-4880-ba2a-3a890acce6ba" class="numbered-list" start="3"><li>И, если я не ошибаюсь, нарушает принцип DRY: именно потому, что одно изменение логики должно быть реализовано и в коде API, и в коде модуля.</li></ol><h2 id="2d299a66-73de-4635-81ce-7e76b307f30d" class="">Задумка</h2><p id="0f1c8972-c46a-4c17-be49-b583c3958db4" class="">Поэтому, я решил сделать свой модуль, который постараюсь лишить всех этих недостатков. Модуль этот должен быть &quot;light&quot; - то есть не должен содержать никакого дублирования работы API. И например, если кто-то захочет использовать метод API &quot;sendHolography&quot;, модуль не должен этому препятствовать, так как это дублирование работы API, который все равно пришлет ошибку:</p><pre id="b6b893e8-3f8a-4d03-8ee4-896141ef6f62" class="code code-wrap"><code>{&quot;ok&quot;:false,&quot;error_code&quot;:404,&quot;description&quot;:&quot;Not Found&quot;}</code></pre><p id="713b027c-4d73-4c3f-b8a4-4eb255e07a88" class="">Или не пришлет, если к этому моменту появятся голографические мониторы и с ними метод &quot;sendHolography&quot;. А модуль, в отличии от pyTelegramBotApi будет автоматически готов к такому обновлению.</p><h2 id="f6b98afe-40e0-44a1-8ee4-17fd795339fd" class="">Начинаем</h2><p id="b41fe1b6-f7cf-4b0b-bede-4c5435d8773b" class="">Создаю класс Bot, он должен содержать все методы Telegram Bot Api, но чтобы модуль не зависел от актуального набора методов, определю метод __getattr__. Он должен возвращать некие объекты, вызов которых будет выполнять метод, это будет вложенная функция. Также, переименовываю её и преобразовываю в метод - чтобы все было красиво. И добавляю этот метод в кэш, чтобы не создавать его заново в следующий раз.</p><pre id="58ba8125-b643-4b6a-b7c8-f7a2356ce4e0" class="code code-wrap"><code>from types import MethodType
class Bot:
    def __init__(self):
        self.cache = {}

    def __getattr__(self, attr: str):
        if attr in cache: return self.cache[attr]

        url = &quot;/bot&quot;+self._token+&quot;/&quot;+snake_case_to_camel_case(attr)
      	async def function(bot, **kwargs):
          	pass
        method = MethodType(function, self)
        self.cache[attr] = method
        return method
</code></pre><p id="0979ba1b-d4bc-4982-8750-81f25acf27e0" class="">Чтобы делать асинхронные get запросы, нужно создать объект aiohttp.ClientSession, однако если попытаться создать её в Bot.__init__, выйдет ошибка:</p><pre id="5435af11-ed15-4076-9599-bb6eecf3da70" class="code code-wrap"><code>The object should be created within an async function</code></pre><p id="26fc6afa-2c99-49ad-8ca1-6a28bfe81e33" class="">Сделать __init__ асинхронным тоже невозможно - асинхронная функция возвращает корутину, при создании объекта появляется ошибка:</p><pre id="bba2ecda-4680-462d-9ca6-919234f2590b" class="code code-wrap"><code>TypeError: __init__() should return None, not &#x27;coroutine&#x27;</code></pre><p id="77754aa4-3900-4bd1-80e0-ba175b6f9bf8" class="">Поэтому применю своего рода костыль - переопределю функцию Bot.__new__ как асинхронную, создам сессию в ней. В таком случае, вызвав __new__ при создании объекта, пользователь получит корутину, а потом, после await, вернется сам объект:</p><pre id="d4730d21-e2b7-4947-bea4-80a4867f8dd0" class="code code-wrap"><code>def __init__(self, token: str):
    self._http_exceptions = {}
    self._token = token
    self.cache = {}

async def __new__(cls, *args, **kwargs):
    obj = super().__new__(cls)
    obj._session = aiohttp.ClientSession(url)
    obj.__init__(*args, **kwargs)
    return obj</code></pre><p id="246c7afd-254c-45dd-9a22-d67462c8f2bb" class="">В предыдущем блоке кода вы можете заметить переменную _http_exceptions. Зачем она нужна? Я могу создать по классу исключения для каждого http кода ошибки, который отправляет telegram, но что если в telegram bot api добавятся новые методы, которые будут отправлять новые коды ошибок? Или, может быть, выйдет новая версия http, в которой будут добавлены новые коды ошибок? В таком случае, придется обновлять библиотеку! Есть решение лучше!)</p><pre id="2e5b4aae-5da5-416b-a445-daeb8a696615" class="code code-wrap"><code>class Bot:
		...
    def get_http_exception(self, number: int):
        if number in self._http_exceptions:
            return self._http_exceptions[number]
        else:
            HttpException = type(f&quot;TelegramError{number}&quot;, (TelegramError,), {})
            self._http_exceptions[number] = HttpException
            return HttpException</code></pre><p id="2f90044a-97e3-457c-a8e6-590ee9e2e76d" class="">Первый аргумент конструктора класса type - название класса, второй - кортеж классов, от которых создаваемый должен наследоваться, а третий - словарь атрибутов класса. Таким образом, если какая-то ошибка запрашивается в первый раз, для нее создается свой класс, наследующийся от TelegramError и сохраняется в словарь Bot._http_exceptions.</p><p id="44d491df-cb51-4e05-84ed-3336fba6f81f" class="">Теперь можно написать ту самую вложенную функцию, которая будет превращаться в разные методы и отправлять запросы на сервер.</p><pre id="c5c76341-360e-4b8f-a2c5-bc5923a62b13" class="code code-wrap"><code>async def function(bot, **kwargs):
  async with bot._session.get(url, params=kwargs) as response:
    response_data = await response.json()
    if response_data[&quot;ok&quot;]:
        return response_data[&quot;result&quot;]
    else:
        raise bot.get_http_exception(response_data[&quot;error_code&quot;])(
          response_data[&quot;description&quot;]
        )</code></pre><p id="98175333-2917-4f6b-9fba-fb9e040fe46a" class="">Если получаю http ошибку - создаю нужное исключение и бросаю его.</p><p id="78ab6f2a-e781-422d-b45c-407aa5f6d5d4" class="">Теперь нужно создать систему, которая будет постоянно запрашивать у сервера обновления, и, если они есть, запускать нужный обработчик сообщений. В PyTelegramBotApi выбор нужного обработчика реализован с помощью системы фильтров, например:</p><pre id="357ad377-054d-4f15-938e-d2d255b45a1a" class="code code-wrap"><code>@bot.message_handler(commands=[&quot;start&quot;, help])
def handler1: ... #для команд /start и /help

@bot.message_handler(content_types=[&quot;photo&quot;], chat_types=[&quot;private&quot;])
def handler2: ... #для фотографий в личных чатах

@bot.message_handler(func=lambda msg: msg.from_user.id in admins)
def handler3: ... #для сообщений, отправители которых в списке админов.</code></pre><p id="1e9925fe-4c30-4b1d-a3ba-6c48d2a11b5f" class="">Меня не устраивает этот подход по такой причине: допустим, мне нужно, чтобы один из обработчиков запускался только при получении сообщения, про которого в базе данных написано, что он админ или владелец. При этом работа самого обработчика должна зависеть от того, пользователь все таки админ или владелец. Получается, что мне нужно будет сделать два запроса к базе данных: один в фильтре, а другой в обработчике и это не эффективно. Да, можно разделить этот обработчик на два: один для сообщений от админов, а другой для сообщений от владельцев. Но тогда часть логики, общую для админов и владельцев придется выносить в отдельные функции, что не удобно.</p><p id="e1f59e70-38ea-4c78-86d9-5fc867b397a9" class="">Поэтому, я выбрал другой вариант. Пусть первым запускается первый определенный обработчик. В нем разработчик может добавить какое-то условие - и по нему выбрасывать исключение с названием NextHandler. В таком случае вызывается следующий обработчик. Если же обработчик выполняется без исключений, событие считается обработанным.</p><pre id="7753a693-b0c3-48ab-b12b-3c2723fb5467" class="code code-wrap"><code>class NextHandler(Exception):
    def __init__(self):
        self.args = (&quot;don&#x27;t use this error outside of light_telegram_bot handler&quot;,)</code></pre><pre id="d4f4c737-fbe3-4a99-8339-e198afa4a1fc" class="code code-wrap"><code>class BotPolling:
    def __init__(self, bot, start_offset=0):
        self._handlers = []
        self._bot = bot
        self._offset = start_offset

    async def start(self, timeout=60, **kwargs):
        try:
            while 1:
                updates = await self._bot.get_updates(
                  	timeout=timeout,
                  	offset=self._offset,
                  	**kwargs
                )
                if updates:
                    self._offset = updates[-1][&quot;update_id&quot;]+1
                for update in updates:
                    for handler in self._handlers:
                        try:
                            await handler(update)
                        except NextHandler:
                            pass
                        else:
                            break
        except Exception:
            raise LightTelegramBotPollingError()

    def handler(self, f):
        self._handlers.append(f)</code></pre><p id="aaba78c7-f343-4a8a-bffb-0b09c8424604" class="">И вот, для сравнения, вот те же три обработчики в моем модуле:</p><pre id="276b95a6-fdab-4e4a-ba5f-df07ff9377a2" class="code code-wrap"><code>@bot.handler()
def handler1(message):
	if not test_commands(message.text, [&quot;start&quot;, &quot;help&quot;]):
  	raise NextHandler()

@bot.handler()
def handler2(message):
	if not (&quot;photo&quot; in message) and message.chat_type == &quot;private&quot;
  	raise NextHandler()

@bot.handler()
def handler3(message):
  if not msg[&quot;from_user&quot;][&quot;id&quot;] in admins:
    raise NextHandler()</code></pre><p id="1d1a5a86-146f-4e3a-bc0e-d70566d9f155" class="">Да, получилось длиннее, но, зато, гораздо более универсально. Остается доделать несколько вещей, не заслуживающих упоминания. И вуаля!</p><p id="2430ad8f-c27d-4907-9d81-06ca13fcf617" class="">Код модуля целиком вы можете посмотреть в репозитории <a href="https://github.com/Chebotarev-Alexey/light_telegram_bot">light_telegram_bot</a>, установить его можно с помощью pip install light_telegram_bot. Спасибо за прочтение статьи!</p></div></article></body></html>