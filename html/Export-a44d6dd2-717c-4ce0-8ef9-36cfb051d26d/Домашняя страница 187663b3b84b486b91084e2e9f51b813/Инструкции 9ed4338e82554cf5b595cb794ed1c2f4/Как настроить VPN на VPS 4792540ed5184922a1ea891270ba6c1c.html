<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Как настроить VPN на VPS?</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	text-indent: -1.7em;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-opaquegray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="4792540e-d518-4922-a1ea-891270ba6c1c" class="page sans"><header><img class="page-cover-image" src="https://images.unsplash.com/photo-1603985529862-9e12198c9a60?ixlib=rb-1.2.1&amp;q=80&amp;cs=tinysrgb&amp;fm=jpg&amp;crop=entropy" style="object-position:center 47.99%"/><div class="page-header-icon page-header-icon-with-cover"><span class="icon">🔐</span></div><h1 class="page-title">Как настроить VPN на VPS?</h1></header><div class="page-body"><nav id="ab6eb74e-c8ca-425c-95bf-b43bb2a0a08c" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#d7aa6725-5af5-4258-921d-341e53ad45f6">⚙️ Настройка и подключение к VPS</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#064299fe-9f3e-4fbd-99b3-b277e78fff82">⚙️ Установка и настройка VPN</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#91340967-8e61-42ea-8f26-ccb3614977f6">🧑‍💻 Полезные команды</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#ebc8abad-bffa-4025-b055-0cdcd51ac1d8">📙 Термины</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#65d33ccb-90b6-4078-9388-9b2eda9969e5">🔐Безопасность</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#171ee53e-76aa-4a22-960b-07ff66a9c83d">ℹ Источники</a></div></nav><h1 id="d7aa6725-5af5-4258-921d-341e53ad45f6" class=""><details open=""><summary>⚙️ Настройка и подключение к VPS</summary></details></h1><div class="indented"><ol type="1" id="93b93c93-f31f-46f3-ac67-e75ffdaee3ac" class="numbered-list" start="1"><li>Устанавливаем операционную систему на сервер. Например: Ubuntu.</li></ol><ol type="1" id="03d4ac2f-f934-4c74-8e7f-06a1ccbcb352" class="numbered-list" start="2"><li>Получаем данные для доступа к серверу: IP-адрес, сервера и порт (при наличии).</li></ol><ol type="1" id="dba5082f-4923-423f-b548-ad0727fb9a26" class="numbered-list" start="3"><li>Подключаемся к сервере по SSH используя консоль Windows или <a href="https://unixhost.pro/clientarea/knowledgebase/13/ssh-podkliuchenie-k-serveru.html">PuTTY</a>.</li></ol></div><h1 id="064299fe-9f3e-4fbd-99b3-b277e78fff82" class=""><details open=""><summary>⚙️ Установка и настройка VPN</summary></details></h1><div class="indented"><h2 id="5267c6ac-0ee3-417f-84e7-05ba159eb1e5" class="">Установка WireGuard Easy + GUI</h2><ol type="1" id="0f264a34-9ec3-4c39-93d8-8136540e491e" class="numbered-list" start="1"><li>Обновить индекс/список пакетов и обновить пакеты ПО до актуальной версии.
<code>apt update &amp;&amp; apt upgrade -y</code></li></ol><ol type="1" id="077006b3-01f5-4ae3-9b88-c8fa7b61c246" class="numbered-list" start="2"><li>Установить <strong>Docker</strong>.<pre id="c418f03f-469d-47a3-9056-5545469dcca3" class="code"><code>curl -sSL https://get.docker.com | sh
sudo usermod -aG docker $(whoami)
exit</code></pre></li></ol><ol type="1" id="1bba2c76-d850-4d21-9b61-627a553b2ada" class="numbered-list" start="3"><li>Установить <strong>WireGuard</strong>, удалив комментарии в тексте и задав настройки.<figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="d18fc593-07d1-44e3-82a5-f5c87ddb1325"><div style="font-size:1.5em"><span class="icon">⚠️</span></div><div style="width:100%">• Дополнительные настройки описаны в документации <a href="https://github.com/WeeJeWel/wg-easy/blob/master/README.md">WireGuard Easy</a>.
• Символ <code>\</code> в конце строки указывает на то, что команда содержит несколько строк, поэтому фрагмент кода ниже нужно отредактировать и вставить для выполнения <strong>целиком</strong>! </div></figure><pre id="73435b58-7894-484a-8202-0442ef3d27b3" class="code"><code>.docker run -d \ (запускаем Docker)
--name=wg-easy \
-e WG_HOST=(IP-адрес вашего сервера без скобок) \
-e PASSWORD=(придумайте пароль для входа в веб-интерфейс) \
-v ~/.wg-easy:/etc/wireguard \
-p 51820:51820/udp \
-p 51821:51821/tcp \
--cap-add=NET_ADMIN \
--cap-add=SYS_MODULE \
--sysctl=&quot;net.ipv4.conf.all.src_valid_mark=1&quot; \
--sysctl=&quot;net.ipv4.ip_forward=1&quot; \
--restart unless-stopped \
weejewel/wg-easy</code></pre></li></ol><ol type="1" id="44e69e86-3236-446d-bf6e-2957a68e5be3" class="numbered-list" start="4"><li>Перейти в веб-интерфейс для добавления новых пользователей.
<code>89.208.142.98:51821</code> в адресной строке браузера.
Где <code>51821</code> — TCP порт веб-интерфейса и <code>89.208.142.98</code>  — IP-адрес сервера.</li></ol><h2 id="447e3295-6814-42e1-b203-2df39e913871" class="">Установка WireGuard (easy-wg-quick)</h2><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="0ac85d01-abee-4747-8c37-007db02c42dd"><div style="font-size:1.5em"><span class="icon">ℹ️</span></div><div style="width:100%">Если в терминале пропала каретка с указанием пользователя, необходимо использовать комбинации клавиш <strong><mark class="highlight-gray"><span style="border-bottom:0.05em solid"><code>Ctrl+C</code></span></mark></strong> или <mark class="highlight-gray"><strong><span style="border-bottom:0.05em solid"><code>Ctrl+D</code></span></strong></mark> для продолжения ввода.</div></figure><ol type="1" id="a2a83cdd-82d0-47f2-8df8-00c44073c226" class="numbered-list" start="1"><li>Устанавливаем WireGuard.
<code>sudo apt install wireguard</code></li></ol><ol type="1" id="b9f53d32-79cf-4918-9c95-ffc2cfa0dde4" class="numbered-list" start="2"><li>Установим пакеты утилит для добавлении профиля в телефон используя QR-код.
<code>sudo apt install wireguard-tools mawk grep iproute2 qrencode</code></li></ol><ol type="1" id="f820434a-95dd-4300-be4b-b51ed2227452" class="numbered-list" start="3"><li>Скачиваем скрипт <a href="https://github.com/burghardt/easy-wg-quick">easy-wg-quick</a> для простой настройки WireGuard.
<code>wget https://raw.githubusercontent.com/burghardt/easy-wg-quick/master/easy-wg-quick</code></li></ol><ol type="1" id="5981d6a4-5e17-4c1c-bdae-ea340ed878c3" class="numbered-list" start="4"><li>Предоставляем права для выполнения скрипта.
<code>chmod +x easy-wg-quick</code></li></ol><ol type="1" id="c41056c9-0a7c-4b53-9747-7b44ca31f493" class="numbered-list" start="5"><li>Запускаем скрипт для создания файла конфигурации и пира/клиента (<strong>пользователя</strong> сети).
<code>./easy-wg-quick</code><ol type="a" id="b8b9017f-60db-4f56-82ca-eb83b2d013f7" class="numbered-list" start="1"><li>При повторном запуске создается другой пир/клиент.</li></ol></li></ol><ol type="1" id="e9fd3219-a0e3-4f03-a33f-72653594918e" class="numbered-list" start="6"><li>Скрипт сгенерирует QR-код для подключения к VPN.</li></ol><ol type="1" id="d2406750-17b3-450f-bc8e-0baf017fd1f5" class="numbered-list" start="7"><li>Открыть файл конфигурации для просмотра параметров подключения (туннеля).
<code>cat wgclient_10.conf</code> или <code>cat /etc/wireguard/wgclient_10.conf</code><pre id="fe78d9e6-6801-41d7-ab39-d44c02c72564" class="code"><code>[Interface]
Address = 10.127.0.10/24
DNS = 1.1.1.1
PrivateKey = WaDsq1e031849jB8QMlr314l;od%62!B1BpDC3L+CvY=

[Peer]
PublicKey = 0mbasfv56!fghhjDbCsasajkyujZmLi2werwei48iEu4fx0=
PresharedKey = bjbOtzase6z05s23QcVoiYtaPo1+QWz5SXHgnA232DD49q1@34Bf0=
AllowedIPs = 0.0.0.0/0, ::/0
Endpoint = 5.5.5.5:14302
PersistentKeepalive = 25</code></pre></li></ol><ol type="1" id="294b0faf-3609-4913-8461-c86b105d2d70" class="numbered-list" start="8"><li> Копируем файл конфигурации <strong>wghub.conf</strong> в директорию <strong>/etc/wireguard/wghub.conf</strong>.
<code>cp wghub.conf /etc/wireguard/wghub.conf</code></li></ol><ol type="1" id="c9799b39-d38e-43cf-a3ff-6aa27e5af99d" class="numbered-list" start="9"><li>Запускаем сервис и добавляем его в автозагрузку.
<code>systemctl start wg-quick@wghub</code> и
<code>systemctl enable wg-quick@wghub</code></li></ol></div><h1 id="91340967-8e61-42ea-8f26-ccb3614977f6" class=""><details open=""><summary>🧑‍💻 Полезные команды</summary></details></h1><div class="indented"><h2 id="b9b0b8b5-a2b5-4975-a793-5afcef842989" class="">Обновить индекс пакетов и обновить пакеты ПО</h2><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="cece02f6-f9f7-48b7-a85b-91d7f77e820a"><div style="font-size:1.5em"><span class="icon">ℹ️</span></div><div style="width:100%">Выполнить команду <code>apt update &amp;&amp; apt upgrade -y</code> для осуществления обоих действий с флагом <code>-y</code> чтобы не подтверждать обновление каждого пакета.</div></figure><ol type="1" id="4a7ea777-d86d-410e-b90e-a86851ea99cb" class="numbered-list" start="1"><li>Выполнить команду <code>apt update</code> после новой установки системы и перед установкой нового программного пакета для обновления индекса/списка пакетов.</li></ol><ol type="1" id="dc254651-538d-40a0-8d04-133274ccb793" class="numbered-list" start="2"><li>Выполнить команду <code>apt update</code> для обновления пакетов ПО до актуальной версии.</li></ol><h2 id="3cfc0c98-4aab-4cc6-8fb8-193c1dcdf55f" class="">Добавление новых пользователей</h2><ol type="1" id="aeed9a8f-0bbf-4807-a9e4-fc7aea3ebd9a" class="numbered-list" start="1"><li>Добавление нового пользователя.
<code>./easy-wg-quick имя_профиля</code></li></ol><h2 id="745f1b26-80ef-4e69-a1e1-e6e51309b5cc" class="">Просмотр текущих подключений</h2><ol type="1" id="ccb6588a-3dcc-4218-80c9-7c9107e60e97" class="numbered-list" start="1"><li>Просмотр текущих подключений.
<code>wg show</code></li></ol><h2 id="c6bf5b55-d565-4dc9-8f6c-e5d96478e628" class="">Просмотр файлов и директорий</h2><ol type="1" id="4020860d-6dde-4cc7-98ed-b2641a55b9eb" class="numbered-list" start="1"><li>Просмотр <strong>директории </strong>с установленным файлами WireGuard.
<code>ls /etc/wireguard/</code> или <code>ls -a</code> для просмотра всех файлов (в т.ч. скрытых) и <code>ls ll</code> или <code>ls -l</code> для подробного просмотра всех файлов в директории.</li></ol><ol type="1" id="a984e6c7-1ab8-4b9c-ad82-bdfca1bbf200" class="numbered-list" start="2"><li>Открытие файла конфигурации <strong>wghub.conf</strong>.
<code>cat /etc/wireguard/wghub.conf</code></li></ol><ol type="1" id="411de233-4413-4642-83ed-5d5f7f7ce444" class="numbered-list" start="3"><li>Переход в директорию с установленным WireGuard.
<code>cd /etc/wireguard</code></li></ol><h2 id="4a484d3b-efbd-4073-89c5-f140e5a5c1eb" class="">Создание приватного и открытого SSH-ключей</h2><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="5946bbb5-33b0-4168-9d85-c574db8f9e02"><div style="font-size:1.5em"><span class="icon">ℹ️</span></div><div style="width:100%">Директории хранения ключей:
открытый — <code><strong>/домашний_каталог/.ssh/id_rsa.pub</strong></code>,
закрытый — <code><strong>/домашний_каталог/.ssh/id_rsa</strong></code>.</div></figure><ol type="1" id="3e8de7e8-89b0-486b-bb95-30a381559464" class="numbered-list" start="1"><li>Запустить генератор SSH-ключей.
<code>ssh-keygen</code></li></ol><ol type="1" id="e40ed63e-3f60-4e80-b915-19eb800c6051" class="numbered-list" start="2"><li>При необходимости, выбрать директорию для сохранения файла или оставить путь по умолчанию (директория указана в скобках).</li></ol><ol type="1" id="c6ccbe56-96f0-4cfb-b3d8-0b52cbe261f7" class="numbered-list" start="3"><li>При необходимости, указать кодовую фразу для дополнительной защиты (будет периодически запрашиваться при подключении к серверу).</li></ol></div><h1 id="ebc8abad-bffa-4025-b055-0cdcd51ac1d8" class=""><details open=""><summary>📙 Термины</summary></details></h1><div class="indented"><ul id="099a1483-901a-48fe-8a50-1d7c842752d8" class="bulleted-list"><li style="list-style-type:disc"><strong>WireGuard</strong> — протокол для организации VPN подключения.</li></ul><ul id="2cdaed83-6d06-40b3-8c8d-cc242772c645" class="bulleted-list"><li style="list-style-type:disc"><strong>wg-easy</strong> — бесплатный графический интерфейс WireGuard с открытым исходным кодом для установки и управления сервером WireGuard VPN (создание, редактирование, удаление клиентов, просмотр статистики, распространение конфигурации путем скачивания и сканирования QR-кода).</li></ul><ul id="b0049149-1528-481c-bc2c-ba6d9b014462" class="bulleted-list"><li style="list-style-type:disc"><strong>SSH (Secure Shell)</strong> — сетевой протокол для обеспечения защищенного подключения к удаленному компьютеру (серверу) и выполнения консольных команд.<ul id="f43f6b93-4cd8-49a8-b689-873ca9951845" class="bulleted-list"><li style="list-style-type:circle">При подключении к серверу через интернет данные передаются через несколько сетей, которые могут быть не безопасны (содержат вредоносные программы и пользователей, отслеживающих запросы).</li></ul><ul id="4bfeddad-85b2-42bc-afe1-f45b3f80c5cb" class="bulleted-list"><li style="list-style-type:circle">SSH создает безопасное подключение между клиентом и сервером для выполнения команд и запросов (в т.ч. для протоколов HTTP и FTP).</li></ul><ul id="3f1c0162-3955-4db7-9276-be4283f51cb0" class="bulleted-list"><li style="list-style-type:circle">Подключение по SSH с помощью ключа исключает риск, который связан с подбором и взломом вашего пароля.</li></ul><ul id="20764785-7f2f-451a-9de8-964e6f90725d" class="bulleted-list"><li style="list-style-type:circle">При каждом обращении к серверу осуществляется сопоставление ключей.</li></ul><ul id="4a42613a-966e-4ecb-b608-82e1964037b5" class="bulleted-list"><li style="list-style-type:circle">Для подключения по SSH необходимо знать: имя пользователя, хост сервера (IP адрес сервера или доменное имя) и пароль/ключ шифрования.
Например: <code>ssh user@0.0.0.0</code> или <code>user@serverhost.com</code></li></ul></li></ul><ul id="c227920e-2c31-4e9a-9416-aee94d58e797" class="bulleted-list"><li style="list-style-type:disc"><strong>Ключи шифрования</strong> — <strong>приватный ключ</strong> остаётся на локальном компьютере в зашифрованном виде, а <strong>публичный (открытый)</strong> ключ хранится на сервере в корневом каталоге в файле <strong>authorized_keys</strong> и может быть предоставлен другим ресурсам для верификации при подключении.</li></ul><ul id="da20a3ec-fdd3-4312-96c4-c0079c244cd0" class="bulleted-list"><li style="list-style-type:disc"><strong>Индексный файл пакетов</strong> — файл или база данных, которые содержат список программных пакетов, определенных в репозиториях, расположенных в файле /etc/apt/sources.list.<ul id="7f14c88c-3d8f-420a-b18d-c5fb5159eec6" class="bulleted-list"><li style="list-style-type:circle">Остальные списки пакетов находятся в каталоге /etc/apt/sources.list.d.</li></ul></li></ul></div><h1 id="65d33ccb-90b6-4078-9388-9b2eda9969e5" class=""><details open=""><summary>🔐Безопасность</summary></details></h1><div class="indented"><ol type="1" id="ce2cbcc4-cb24-4956-92f8-5e2bc49a0000" class="numbered-list" start="1"><li>Отключение аутентификации под <strong>root </strong>пользователем.</li></ol><ol type="1" id="23cfe570-a7ec-4654-ba31-2039e5dcd93e" class="numbered-list" start="2"><li>Настроить аутентификацию по SSH-ключу для подключения к серверу без пароля:<ol type="a" id="ee450e7d-9d42-4d20-9504-0a23db32727c" class="numbered-list" start="1"><li><a href="%D0%9A%D0%B0%D0%BA%20%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B8%D1%82%D1%8C%20VPN%20%D0%BD%D0%B0%20VPS%204792540ed5184922a1ea891270ba6c1c.html">Сгенерировать ключ</a>.</li></ol><ol type="a" id="5a599630-4b07-4931-95d9-66a88399ab59" class="numbered-list" start="2"><li>Предоставить публичный ключ (скопировать на указанный компьютер)
<code>ssh-copy_id имя_пользователя@адрес_сервера</code>.</li></ol><ol type="a" id="5ed228ef-8dc7-4e5f-b788-85e7b94d0713" class="numbered-list" start="3"><li>Ввести текущий пароль.</li></ol></li></ol><ol type="1" id="6ebb0857-628e-4400-98a4-ef6bc872471c" class="numbered-list" start="3"><li>Отключить доступ по паролю к серверу:<ol type="a" id="8a21e248-7d29-44b7-872b-27f6828391a9" class="numbered-list" start="1"><li>Открыть файл с настройками подключения по SSH и поменять <code>PasswordAuthentication</code> на <code>no</code>.
<code>nano /etc/ssh/sshd_config</code></li></ol><ol type="a" id="4dd7c58d-f0cf-415b-9c34-2924900a9bc4" class="numbered-list" start="2"><li>Перезагрузить сервис SSH после внесенных изменений.
<code>service ssh restart</code></li></ol></li></ol><ol type="1" id="7117c659-b41e-4022-be74-4e012408478e" class="numbered-list" start="4"><li>Изменить в файле файле <code>wghub.conf</code>:<ol type="a" id="b105150f-9269-45aa-96d7-199fdd693bc6" class="numbered-list" start="1"><li><strong>Порт </strong>— выбрать любой неиспользуемый, после 50000, т.к. злоумышленники чаще всего не сканируют эти порты.</li></ol><ol type="a" id="b5fbb57b-3bee-4642-996f-daee6eabecf9" class="numbered-list" start="2"><li><strong>IP-адрес</strong> — любой удобный для меня. Дополнительно внести изменения в файл <code>portno.txt</code>.</li></ol></li></ol><ol type="1" id="465ab0f0-b018-458c-858d-7bb8cf849fca" class="numbered-list" start="5"><li>Дополнительная информация:<ol type="a" id="c27e16ff-f2f6-4f0c-b411-bb8ae0c6e3bb" class="numbered-list" start="1"><li>Запускать контейнер Docker не под root пользователем.</li></ol><ol type="a" id="46bc351d-7f32-44c5-8dfc-12c01e032601" class="numbered-list" start="2"><li>Добавить 2FA авторизация при подключении по SSH.</li></ol><ol type="a" id="f09f38d4-f62c-40b5-9d66-dc05ee11b73e" class="numbered-list" start="3"><li>Более надежный VPN на основе Shadowsocks + v2ray + cloudflare, vpn over https (<a href="https://krasovs.ky/2022/03/19/shadowsocks-and-v2ray-and-cloudflare.html">Ссылка</a>, <a href="https://habr.com/ru/post/555768/">Ссылка</a>, <a href="https://overclockers.ru/blog/Indigo81/show/31739/shadowsocks-cherez-cloudflare-cdn-povyshaem-bezopasnost-v-seti">Ссылка</a>).</li></ol><ol type="a" id="bf3a2d13-3b00-4b20-9db3-dc3f59e673b1" class="numbered-list" start="4"><li>Настроить защиту от DDoS-атак — iptables, Fail2ban, mangle и т.д.</li></ol><ol type="a" id="69e61d0e-6d61-4161-9aa7-0b9927f085e6" class="numbered-list" start="5"><li>Настроить на сервере WireGuard фильтр рекламы и трекеров — Pi-hole, Unbound.</li></ol></li></ol></div><h1 id="171ee53e-76aa-4a22-960b-07ff66a9c83d" class=""><details open=""><summary>ℹ Источники</summary></details></h1><div class="indented"><p id="3f8aaa86-40ab-4d59-9c86-18062016715c" class=""><strong>Установка WireGuard easy-wg-quick</strong></p><ul id="61e41276-f488-43d0-a18d-6d46feb8c3a1" class="bulleted-list"><li style="list-style-type:disc"><a href="https://unixhost.pro/clientarea/knowledgebase/63/ustanovka-wireguard.html">Статья</a> и <a href="https://youtu.be/it8ZoklxceY">видео</a></li></ul><ul id="7f36d512-bf1e-40ef-b4d1-420b3dc30e69" class="bulleted-list"><li style="list-style-type:disc"><a href="https://github.com/burghardt/easy-wg-quick">Документация скрипта easy-wg-quick</a></li></ul><p id="bbb819a8-d864-420d-9f89-80e2183b4975" class=""><strong>Установка и ручная настройка WireGuard</strong></p><ul id="94c4fd53-c9fb-42e8-ae20-7b422a7fd4d0" class="bulleted-list"><li style="list-style-type:disc"><a href="https://youtu.be/5Aql0V-ta8A">Видео</a></li></ul><p id="618c856e-ba33-457a-8a42-be4d144c600c" class=""><strong>Что такое SSH</strong></p><ul id="2e0cf57a-9772-4211-ad54-6a7ddc36cb7a" class="bulleted-list"><li style="list-style-type:disc"><a href="https://youtu.be/v45p_kJV9i4">Видео</a></li></ul><p id="e5c07adf-e460-41b8-a3f3-c413ad9d544e" class=""><strong>Установка WireGuard Easy</strong></p><ul id="19bf4a0b-e0c0-4cc8-9662-371443d704d4" class="bulleted-list"><li style="list-style-type:disc"><a href="https://tech.davidfield.co.uk/2022/06/22/wireguard-the-easy-way/">Статья</a> (объяснение параметров), <a href="https://dtf.ru/howto/1278689-delaem-bystryy-i-nadezhnyy-vpn-s-32-tb-trafika-na-baze-wireguard-za-15-minut">Статья</a> (обсуждение в комментах)</li></ul><ul id="1ac45a44-4b58-45df-bed4-2d3ee5177eb7" class="bulleted-list"><li style="list-style-type:disc"><a href="https://github.com/WeeJeWel/wg-easy">Документация WireGuard Easy</a></li></ul><p id="de38d562-4c5c-4e21-860c-e58efa95aeb3" class=""><strong>Другие варианты VPN</strong></p><ul id="4007fe2f-4935-4942-b2f6-769df409125f" class="bulleted-list"><li style="list-style-type:disc"><a href="https://2ch.hk/s/catalog.html">Треды на Двач про обход блокировок в разделе /s/</a></li></ul><ul id="054e9273-8169-48bf-bac9-1e48e236b5ed" class="bulleted-list"><li style="list-style-type:disc"><a href="https://habr.com/ru/post/566650/">SoftEther VPN</a> (наиболее перспективный, в случае блокировки WireGuard)</li></ul><ul id="3e87d771-9537-4b50-9429-b2b989e92032" class="bulleted-list"><li style="list-style-type:disc"><a href="https://krasovs.ky/2022/03/19/shadowsocks-and-v2ray-and-cloudflare.html">Shadowsocks + V2Ray + Cloudflare</a>, <a href="https://habr.com/ru/post/555768/">Cервер Shadowsocks</a></li></ul><ul id="06681430-4ba2-4d28-9987-18ca36436184" class="bulleted-list"><li style="list-style-type:disc"><a href="https://vpn.inform.click/objasnenie-metodov-obfuskacii-vpn-i-zhargona/">Обфускация VPN</a>, <a href="https://dtf.ru/ask/847645-vpn-s-obfuskaciey-trafika-kakoy-posovetuete">VPN с обфускацией трафика</a>, <a href="https://wiki.iphoster.net/wiki/VPN_-_%D0%BE%D0%B1%D1%84%D1%83%D1%81%D0%BA%D0%B0%D1%86%D0%B8%D1%8F_%D1%82%D1%80%D0%B0%D1%84%D0%B8%D0%BA%D0%B0_-_%D1%87%D1%82%D0%BE_%D1%8D%D1%82%D0%BE_%D1%82%D0%B0%D0%BA%D0%BE%D0%B5">Обфускация трафика</a></li></ul><ul id="f0951996-6e11-4b86-ba43-37bf92406803" class="bulleted-list"><li style="list-style-type:disc"><a href="https://habr.com/ru/post/415977/">Туннели и VPN, устойчивые к DPI</a></li></ul></div></div></article></body></html>